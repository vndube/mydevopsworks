BROKER SCHEMA com.icici.xpress_connect.ecollection.mh.ci.intimation


CREATE FILTER MODULE CustomerIntimationHandlerImmediate_isReqElegibleforQueryBack_
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN

--		Check availability of time window as per txn type to either procced with Customer call 
--		or call Query Back API for reconcillation. This section also helps in determining 
--		model specific decision making of Query back call pattern

		DECLARE refAPIRequest REFERENCE TO Environment.Variables.eCollection.mh.API.Request.Message;
		DECLARE timeElapsed INTERVAL (CURRENT_TIMESTAMP - CAST(refAPIRequest.request_datetime AS TIMESTAMP FORMAT 'IU')) SECOND;
		IF refAPIRequest.payment_mode = API_PAYMENT_MODE_NEFT THEN
			IF timeElapsed >= CAST(NEFT_TXN_REQ_WINDOW AS INTERVAL SECOND) THEN
				IF CLIENT_SUBSCRIBED_API_MODEL IN (CLIENT_SUBSCRIBED_API_MODEL_TYPE_2, CLIENT_SUBSCRIBED_API_MODEL_TYPE_4,
						CLIENT_SUBSCRIBED_API_MODEL_TYPE_6, CLIENT_SUBSCRIBED_API_MODEL_TYPE_8) THEN
					RETURN TRUE;
				ELSE				
					RETURN FALSE;
				END IF;
				RETURN FALSE;
			ELSEIF timeElapsed < CAST(NEFT_TXN_REQ_WINDOW AS INTERVAL SECOND) THEN
				IF CLIENT_SUBSCRIBED_API_MODEL IN (CLIENT_SUBSCRIBED_API_MODEL_TYPE_2, CLIENT_SUBSCRIBED_API_MODEL_TYPE_4,
						CLIENT_SUBSCRIBED_API_MODEL_TYPE_6, CLIENT_SUBSCRIBED_API_MODEL_TYPE_8) THEN
					RETURN TRUE;
				ELSE	
					RETURN FALSE;
				END IF;
			END IF;
		ELSEIF refAPIRequest.payment_mode = API_PAYMENT_MODE_RTGS THEN
			IF timeElapsed >= CAST(RTGS_TXN_REQ_WINDOW AS INTERVAL SECOND) THEN
				IF CLIENT_SUBSCRIBED_API_MODEL IN (CLIENT_SUBSCRIBED_API_MODEL_TYPE_2, CLIENT_SUBSCRIBED_API_MODEL_TYPE_4,
						CLIENT_SUBSCRIBED_API_MODEL_TYPE_6, CLIENT_SUBSCRIBED_API_MODEL_TYPE_8) THEN
					RETURN TRUE;
				ELSE				
					RETURN FALSE;
				END IF;
				RETURN FALSE;
			ELSEIF timeElapsed < CAST(RTGS_TXN_REQ_WINDOW AS INTERVAL SECOND) THEN
				IF CLIENT_SUBSCRIBED_API_MODEL IN (CLIENT_SUBSCRIBED_API_MODEL_TYPE_2, CLIENT_SUBSCRIBED_API_MODEL_TYPE_4,
						CLIENT_SUBSCRIBED_API_MODEL_TYPE_6, CLIENT_SUBSCRIBED_API_MODEL_TYPE_8) THEN
					RETURN TRUE;
				ELSE	
					RETURN FALSE;
				END IF;
			END IF;
		ELSEIF refAPIRequest.payment_mode = API_PAYMENT_MODE_IMPS THEN
			IF timeElapsed >= CAST(IMPS_TXN_REQ_WINDOW AS INTERVAL SECOND) THEN
				IF CLIENT_SUBSCRIBED_API_MODEL IN (CLIENT_SUBSCRIBED_API_MODEL_TYPE_2, CLIENT_SUBSCRIBED_API_MODEL_TYPE_4,
						CLIENT_SUBSCRIBED_API_MODEL_TYPE_6, CLIENT_SUBSCRIBED_API_MODEL_TYPE_8) THEN
					RETURN TRUE;
				ELSE				
					RETURN FALSE;
				END IF;
				RETURN FALSE;
			ELSEIF timeElapsed < CAST(IMPS_TXN_REQ_WINDOW AS INTERVAL SECOND) THEN
				IF CLIENT_SUBSCRIBED_API_MODEL IN (CLIENT_SUBSCRIBED_API_MODEL_TYPE_2, CLIENT_SUBSCRIBED_API_MODEL_TYPE_4,
						CLIENT_SUBSCRIBED_API_MODEL_TYPE_6, CLIENT_SUBSCRIBED_API_MODEL_TYPE_8) THEN
				ELSE	
					RETURN FALSE;
				END IF;
			END IF;
		ELSEIF refAPIRequest.payment_mode = API_PAYMENT_MODE_UPI THEN
			IF timeElapsed >= CAST(UPI_TXN_REQ_WINDOW AS INTERVAL SECOND) THEN
				IF CLIENT_SUBSCRIBED_API_MODEL IN (CLIENT_SUBSCRIBED_API_MODEL_TYPE_2, CLIENT_SUBSCRIBED_API_MODEL_TYPE_4,
						CLIENT_SUBSCRIBED_API_MODEL_TYPE_6, CLIENT_SUBSCRIBED_API_MODEL_TYPE_8) THEN
					RETURN TRUE;
				ELSE				
					RETURN FALSE;
				END IF;
				RETURN FALSE;
			ELSEIF timeElapsed < CAST(UPI_TXN_REQ_WINDOW AS INTERVAL SECOND) THEN
				IF CLIENT_SUBSCRIBED_API_MODEL IN (CLIENT_SUBSCRIBED_API_MODEL_TYPE_2, CLIENT_SUBSCRIBED_API_MODEL_TYPE_4,
						CLIENT_SUBSCRIBED_API_MODEL_TYPE_6, CLIENT_SUBSCRIBED_API_MODEL_TYPE_8) THEN
				ELSE	
					RETURN FALSE;
				END IF;
			END IF;
		ELSEIF refAPIRequest.payment_mode = API_PAYMENT_MODE_FT THEN
			IF timeElapsed >= CAST(FT_TXN_REQ_WINDOW AS INTERVAL SECOND) THEN
				IF CLIENT_SUBSCRIBED_API_MODEL IN (CLIENT_SUBSCRIBED_API_MODEL_TYPE_2, CLIENT_SUBSCRIBED_API_MODEL_TYPE_4,
						CLIENT_SUBSCRIBED_API_MODEL_TYPE_6, CLIENT_SUBSCRIBED_API_MODEL_TYPE_8) THEN
					RETURN TRUE;
				ELSE				
					RETURN FALSE;
				END IF;
				RETURN FALSE;
			ELSEIF timeElapsed < CAST(FT_TXN_REQ_WINDOW AS INTERVAL SECOND) THEN
				IF CLIENT_SUBSCRIBED_API_MODEL IN (CLIENT_SUBSCRIBED_API_MODEL_TYPE_2, CLIENT_SUBSCRIBED_API_MODEL_TYPE_4,
						CLIENT_SUBSCRIBED_API_MODEL_TYPE_6, CLIENT_SUBSCRIBED_API_MODEL_TYPE_8) THEN
				ELSE	
					RETURN FALSE;
				END IF;
			END IF;
		END IF;

		RETURN TRUE;
	END;

END MODULE;
